{"version":3,"sources":["/app/packages/framework/src/Session.ts"],"sourcesContent":["const $storage = Symbol(\"object\");\n\n/**\n * Bag of key-values associated with the current actor running this request or action\n **/\nexport class Session {\n  static fromInput(input?: Record<string, any>) {\n    if (input) {\n      return new Session(input.id, input);\n    }\n  }\n\n  changedKeys = new Set<string>();\n  ended = false;\n  [$storage]: Record<string, any>;\n\n  constructor(private _id: string | null, obj: Record<string, any>) {\n    this[$storage] = obj;\n  }\n\n  get(key: string) {\n    return this[$storage][key];\n  }\n\n  set(key: string, value: any) {\n    this.changedKeys.add(key);\n    this[$storage][key] = value;\n  }\n\n  delete(key: string) {\n    this.changedKeys.add(key);\n    this[$storage][key] = null;\n  }\n\n  end() {\n    this.changedKeys.add(\"id\");\n    this.ended = true;\n  }\n\n  clearChanges() {\n    this.changedKeys.clear();\n  }\n\n  get changed() {\n    return this.changedKeys.size > 0;\n  }\n\n  toJSON() {\n    return this[$storage];\n  }\n\n  toChangedJSON() {\n    const changes: Record<string, any> = {};\n    for (const key of this.changedKeys) {\n      changes[key] = this[$storage][key];\n    }\n    return changes;\n  }\n\n  get id() {\n    return this._id;\n  }\n\n  set id(value: string | null) {\n    this._id = value;\n    this.set(\"id\", this._id);\n  }\n}\n"],"names":["Session","$storage","Symbol","_id","fromInput","input","id","changedKeys","ended","constructor","obj","Set","get","key","set","value","add","delete","end","clearChanges","clear","changed","size","toJSON","toChangedJSON","changes"],"mappings":";;;;+BAKaA;;;eAAAA;;;AALb,MAAMC,WAAWC,OAAO;AAKjB,MAAMF;IAWSG;IAVpB,OAAOC,UAAUC,KAA2B,EAAE;QAC5C,IAAIA,OAAO;YACT,OAAO,IAAIL,QAAQK,MAAMC,EAAE,EAAED;QAC/B;IACF;IAEAE,YAAgC;IAChCC,MAAc;IACd,CAACP,SAAS,CAAsB;IAEhCQ,YAAoBN,KAAoBO,GAAwB,CAAE;mBAA9CP;aAJpBI,cAAc,IAAII;aAClBH,QAAQ;QAIN,IAAI,CAACP,SAAS,GAAGS;IACnB;IAEAE,IAAIC,GAAW,EAAE;QACf,OAAO,IAAI,CAACZ,SAAS,CAACY,IAAI;IAC5B;IAEAC,IAAID,GAAW,EAAEE,KAAU,EAAE;QAC3B,IAAI,CAACR,WAAW,CAACS,GAAG,CAACH;QACrB,IAAI,CAACZ,SAAS,CAACY,IAAI,GAAGE;IACxB;IAEAE,OAAOJ,GAAW,EAAE;QAClB,IAAI,CAACN,WAAW,CAACS,GAAG,CAACH;QACrB,IAAI,CAACZ,SAAS,CAACY,IAAI,GAAG;IACxB;IAEAK,MAAM;QACJ,IAAI,CAACX,WAAW,CAACS,GAAG,CAAC;QACrB,IAAI,CAACR,KAAK,GAAG;IACf;IAEAW,eAAe;QACb,IAAI,CAACZ,WAAW,CAACa,KAAK;IACxB;IAEA,IAAIC,UAAU;QACZ,OAAO,IAAI,CAACd,WAAW,CAACe,IAAI,GAAG;IACjC;IAEAC,SAAS;QACP,OAAO,IAAI,CAACtB,SAAS;IACvB;IAEAuB,gBAAgB;QACd,MAAMC,UAA+B,CAAC;QACtC,KAAK,MAAMZ,OAAO,IAAI,CAACN,WAAW,CAAE;YAClCkB,OAAO,CAACZ,IAAI,GAAG,IAAI,CAACZ,SAAS,CAACY,IAAI;QACpC;QACA,OAAOY;IACT;IAEA,IAAInB,KAAK;QACP,OAAO,IAAI,CAACH,GAAG;IACjB;IAEA,IAAIG,GAAGS,KAAoB,EAAE;QAC3B,IAAI,CAACZ,GAAG,GAAGY;QACX,IAAI,CAACD,GAAG,CAAC,MAAM,IAAI,CAACX,GAAG;IACzB;AACF"}